<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatroom</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        #title {
            display: flex; /* Enable flexbox for layout */
            align-items: center; /* Vertically align items to the center */
        }

        #title img {
            height: 50px; /* Adjust the initial size as needed */
            margin-right: 10px; /* Add space between image and text */
        }

        #top-right-links {
            position: absolute;
            top: 10px; /* Adjust top position */
            right: 10px; /* Adjust right position */
            display: flex; /* Use flexbox to align the buttons horizontally */
            gap: 10px; /* Add space between buttons */
            align-items: center; /* Align items vertically with the title */
        }

        #top-right-links a {
            text-decoration: none; /* Remove underline from links */
            background-color: #4CAF50; /* Add background color for the buttons */
            color: white; /* Text color */
            padding: 10px 15px; /* Padding for the button */
            border-radius: 5px; /* Round the corners */
            font-size: 16px; /* Adjust font size */
            display: inline-block; /* Make the link behave like a button */
        }

        #top-right-links a:hover {
            background-color: #45a049; /* Darken button color on hover */
        }
    </style>
</head>
<body>

    <div id="title">
        <img src="{{ url_for('static', filename='chat_icon.jpg') }}" alt="Chatroom Logo">
        Chatroom v1.02
    </div>

    <!-- Group links in a container -->
    <div id="top-right-links">
        <a href="{{ url_for('about') }}">About</a>
        <a href="{{ url_for('news') }}">News</a>
        <a href="{{ url_for('rules') }}">Rules</a>
        <a href="{{ url_for('image_viewer') }}">View Images</a>
    </div>


    <div id="chat">
        <ul id="messages">
            {% for message in messages %}
                <li id="message-{{ message.id }}">
                    {% if message.content.startswith('/images/') %}
                        <img src="{{ message.content }}" alt="Image">
                    {% else %}
                        {{ message.content }}
                    {% endif %}
                    {% if message.username %}
                        - <strong>{{ message.username }}</strong>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>

    <form id="chat-form" onsubmit="submitMessage(event)">
        <input type="text" id="message-input" name="message" placeholder="Type a message..." required maxlength="1000">
        <button type="submit">Send</button>
    </form>

    <script>
        function submitMessage(event) {
            event.preventDefault();

            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;

            if (message) {
                fetch('{{ url_for("send_message") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const messagesList = document.getElementById('messages');
                        const newMessage = document.createElement('li');

                        // Check if the message is an image URL
                        if (data.message.startsWith('/images/')) {
                            const img = document.createElement('img');
                            img.src = data.message;
                            img.alt = 'Image';
                            newMessage.appendChild(img);
                        } else {
                            newMessage.textContent = data.message;
                        }

                        messagesList.appendChild(newMessage);
                        messagesList.scrollTop = messagesList.scrollHeight;
                        messageInput.value = '';
                    } else if (data.status === 'error') {
                        alert(data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }

    // Poll for new messages every 3 seconds
    function pollForMessages() {
        fetch('{{ url_for("index_page") }}')
            .then(response => response.text())
            .then(data => {
                // Use a DOM parser to extract the new messages from the HTML response
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const newMessages = doc.getElementById('messages');

                // Check if the messages list has changed
                const currentMessages = document.getElementById('messages');
                if (newMessages.innerHTML !== currentMessages.innerHTML) {
                    currentMessages.innerHTML = newMessages.innerHTML;

                    // Scroll to the bottom of the chat
                    currentMessages.scrollTop = currentMessages.scrollHeight;
                }
            })
            .catch(error => console.error('Error fetching new messages:', error));
    }

    // Start polling every 3 seconds (3000ms)
    setInterval(pollForMessages, 3000);

   </script>

</body>
</html>


