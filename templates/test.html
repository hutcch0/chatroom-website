<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games & Fake Money</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/games.css') }}">
</head>
<body>

    <div id="header">
        <h1>Welcome to the Games page, {{ username }}!</h1>
        <div id="balance">Your Fake Money: $<span id="fake-money">{{ fake_money }}</span></div>
    </div>

    <div class="betting-container">
        <h3>Place Your Bet (Blackjack and Guess the Number only)</h3>
        <input type="number" id="bet-amount" min="1" placeholder="Enter bet amount" />
        <button class="game-button" id="place-bet">Place Bet</button>
        <div id="bet-error" class="game-result"></div>
    </div>

    <div class="games-container">
        <!-- Spin the Wheel Game -->
        <div class="game-container">
            <h3>Spin the Wheel</h3>
            <p>Try your luck! Spin the wheel to win or lose some fake money!</p>
            <button class="game-button" id="spin-wheel">Spin</button>
            <div id="wheel-result" class="game-result"></div>
            <div id="spin-cooldown" class="game-result"></div> <!-- Cooldown message -->
        </div>

        <!-- Guess the Number Game -->
        <div class="game-container">
            <h3>Guess the Number</h3>
            <p>Guess the correct number between 1 and 10 to win fake money!</p>
            <input type="number" id="guess-number" min="1" max="10" placeholder="Your guess" />
            <button class="game-button" id="submit-guess">Submit Guess</button>
            <div id="guess-result" class="game-result"></div>
        </div>

        <!-- Blackjack Game -->
        <div class="game-container" id="blackjack-game">
            <h3>Blackjack</h3>
            <p>Try your luck against the dealer! The goal is to get as close to 21 as possible without going over.</p>
            <button class="game-button" id="start-blackjack">Start Game</button>
            <div id="blackjack-cards"></div>
            <button class="game-button" id="hit" disabled>Hit</button>
            <button class="game-button" id="stand" disabled>Stand</button>
            <div id="blackjack-result"></div>
        </div>

        <!-- New Dice Roll Game -->
        <div class="game-container">
            <h3>Dice Roll</h3>
            <p>Roll the dice and win or lose some fake money based on the roll!</p>
            <button class="game-button" id="roll-dice">Roll Dice</button>
            <div id="dice-result" class="game-result"></div>
        </div>

		<!-- Higher or Lower Game -->
		<div class="game-container">
    		<h3>Higher or Lower</h3>
    		<p>Guess if the next number will be higher or lower!</p>
    		<div id="current-number" class="game-result">Current number: 50</div>
    		<button class="game-button" id="higher">Higher</button>
    		<button class="game-button" id="lower">Lower</button>
    		<div id="hl-result" class="game-result"></div>
		</div>

        <!-- New Coin Flip Game -->
        <div class="game-container">
            <h3>Coin Flip</h3>
            <p>Flip a coin and guess whether it will land on heads or tails!</p>
            <button class="game-button" id="flip-coin">Flip Coin</button>
            <input type="text" id="coin-guess" placeholder="Enter heads or tails" />
            <div id="coin-result" class="game-result"></div>
        </div>
    </div>

    <div class="leaderboard-container">
        <h3>Leaderboard</h3>
        <p><a href="{{ url_for('leaderboard') }}">View Leaderboard</a></p>

        <h3>chatroom</h3>
        <p><a href="{{ url_for('index_page') }}">View chatroom</a></p>
    </div>

    <script>
        let fakeMoney = {{ fake_money }};
        let currentBet = 0;
        let spinCooldown = false;
        const cooldownTime = 5000;

        function updateFakeMoney() {
            document.getElementById('fake-money').textContent = fakeMoney;
        }

        function saveFakeMoney() {
            fetch('/update_fake_money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ fake_money: fakeMoney })
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      console.log('Fake money updated successfully!');
                  } else {
                      console.log('Error updating fake money.');
                  }
              }).catch(error => {
                  console.error('Error:', error);
              });
        }

        document.getElementById('place-bet').addEventListener('click', () => {
            const betAmount = parseInt(document.getElementById('bet-amount').value);

            if (isNaN(betAmount) || betAmount <= 0) {
                document.getElementById('bet-error').textContent = "Please enter a valid bet amount.";
                return;
            }

            if (betAmount > fakeMoney) {
                document.getElementById('bet-error').textContent = "You don't have enough fake money to place this bet.";
                return;
            }

            currentBet = betAmount;
            document.getElementById('bet-error').textContent = "";
            document.getElementById('bet-amount').disabled = true;
            document.getElementById('place-bet').disabled = true;
        });

        // Dice Roll Game Logic
        document.getElementById('roll-dice').addEventListener('click', () => {
            const roll = Math.floor(Math.random() * 6) + 1;
            let resultMessage = '';
            if (roll > 3) {
                const winAmount = 20;
                fakeMoney += winAmount;
                resultMessage = `You rolled a ${roll} and won $${winAmount}!`;
            } else {
                fakeMoney -= 10;
                resultMessage = `You rolled a ${roll} and lost $10.`;
            }
            document.getElementById('dice-result').textContent = resultMessage;
            updateFakeMoney();
            saveFakeMoney();
        });

		// Higher or Lower Game Logic
		let currentNumber = 50; // Initial number

		document.getElementById('higher').addEventListener('click', () => guessHL('higher'));
		document.getElementById('lower').addEventListener('click', () => guessHL('lower'));

		function guessHL(guess) {
    		const nextNumber = Math.floor(Math.random() * 100) + 1; // Random number between 1 and 100
    		let resultMessage = '';

    		if ((guess === 'higher' && nextNumber > currentNumber) || (guess === 'lower' && nextNumber < currentNumber)) {
        		resultMessage = `Correct! The next number was ${nextNumber}. You win $20!`;
        		fakeMoney += 20; // Win 20 fake money
    		} else {
        		resultMessage = `Incorrect! The next number was ${nextNumber}. You lose $10.`;
        		fakeMoney -= 10; // Lose 10 fake money
    		}

    		currentNumber = nextNumber; // Update the current number
    		document.getElementById('current-number').textContent = `Current number: ${currentNumber}`;
    		document.getElementById('hl-result').textContent = resultMessage;
    		updateFakeMoney();
    		saveFakeMoney();
		}

        document.querySelectorAll('.tic-tac-toe-cell').forEach((cell, index) => {
            cell.addEventListener('click', () => handleClick(index));
        });

        // Coin Flip Game Logic
        document.getElementById('flip-coin').addEventListener('click', () => {
            const guess = document.getElementById('coin-guess').value.toLowerCase();
            if (guess !== 'heads' && guess !== 'tails') {
                document.getElementById('coin-result').textContent = "Please guess either heads or tails.";
                return;
            }

            const flipResult = Math.random() < 0.5 ? 'heads' : 'tails';
            if (guess === flipResult) {
                const winAmount = 50;
                fakeMoney += winAmount;
                document.getElementById('coin-result').textContent = `You guessed ${flipResult} and won $${winAmount}!`;
            } else {
                const lossAmount = 30;
                fakeMoney -= lossAmount;
                document.getElementById('coin-result').textContent = `You guessed ${guess} but it was ${flipResult}. You lost $${lossAmount}.`;
            }
            updateFakeMoney();
            saveFakeMoney();
        });

        updateFakeMoney();
    </script>

</body>
</html>
